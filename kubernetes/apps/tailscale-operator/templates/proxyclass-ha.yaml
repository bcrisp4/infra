# ProxyClass for HA ingress ProxyGroup with topology spread
# Does not include Linkerd injection (blocked until operator 1.94)
apiVersion: tailscale.com/v1alpha1
kind: ProxyClass
metadata:
  name: ha-ingress
spec:
  statefulSet:
    pod:
      # Spread replicas across nodes for HA
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: ScheduleAnyway
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: tailscale
      tailscaleContainer:
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 500m
            memory: 256Mi
